(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const p=10,f=20,o=30,l=["transparent","cyan","blue","orange","yellow","green","purple","red"],g=[[],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],h={LEFT:"ArrowLeft",RIGHT:"ArrowRight",DOWN:"ArrowDown",UP:"ArrowUp",SPACE:" "},c={SINGLE:100,DOUBLE:300,TRIPLE:500,TETRIS:800,SOFT_DROP:1,HARD_DROP:2},d=[800,720,630,550,470,380,300,220,130,100];class y{constructor(e){this.ctx=e,this.grid=this.getEmptyGrid()}getEmptyGrid(){return Array.from({length:f},()=>Array(p).fill(0))}isValid(e){return e.shape.every((t,s)=>t.every((i,r)=>{let a=e.x+r,u=e.y+s;return i===0||this.isInsideWalls(a)&&this.isAboveFloor(u)&&this.notOccupied(a,u)}))}isInsideWalls(e){return e>=0&&e<p}isAboveFloor(e){return e<=f}notOccupied(e,t){return this.grid[t]&&this.grid[t][e]===0}rotate(e){let t=JSON.parse(JSON.stringify(e));for(let s=0;s<t.shape.length;++s)for(let i=0;i<s;++i)[t.shape[i][s],t.shape[s][i]]=[t.shape[s][i],t.shape[i][s]];return t.shape.forEach(s=>s.reverse()),t}drop(e){let t=JSON.parse(JSON.stringify(e));return t.y+=1,t}freeze(e){e.shape.forEach((t,s)=>{t.forEach((i,r)=>{i>0&&(this.grid[e.y+s][e.x+r]=i)})})}clearLines(){let e=0;return this.grid.forEach((t,s)=>{t.every(i=>i>0)&&(e++,this.grid.splice(s,1),this.grid.unshift(Array(p).fill(0)))}),e}}class x{constructor(e){this.ctx=e,this.spawn()}spawn(){this.typeId=this.randomizeTetrominoType(g.length-1),this.shape=g[this.typeId],this.color=l[this.typeId],this.x=0,this.y=0,this.hardDropped=!1}randomizeTetrominoType(e){return Math.floor(Math.random()*e)+1}setStartingPosition(){this.x=3,this.y=0}move(e){this.x=e.x,this.y=e.y,this.shape=e.shape}}class E{constructor(e){this.ctx=e}draw(e,t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBoard(e),this.drawPiece(t)}drawBoard(e){e.grid.forEach((t,s)=>{t.forEach((i,r)=>{i>0&&(this.ctx.fillStyle=l[i],this.ctx.shadowBlur=10,this.ctx.shadowColor=l[i],this.ctx.fillRect(r*o,s*o,o-1,o-1),this.ctx.shadowBlur=0)})})}drawPiece(e){e.shape.forEach((t,s)=>{t.forEach((i,r)=>{i>0&&(this.ctx.fillStyle=l[e.typeId],this.ctx.shadowBlur=15,this.ctx.shadowColor=l[e.typeId],this.ctx.fillRect((e.x+r)*o,(e.y+s)*o,o-1,o-1),this.ctx.shadowBlur=0)})})}}class v{constructor(e){this.game=e,document.addEventListener("keydown",t=>{if([h.LEFT,h.RIGHT,h.UP,h.DOWN,h.SPACE].includes(t.key)&&t.preventDefault(),!this.game.isGameOver&&!(this.game.isPaused&&t.key!=="p")){if(t.key===h.LEFT)this.game.movePiece(-1,0);else if(t.key===h.RIGHT)this.game.movePiece(1,0);else if(t.key===h.DOWN)this.game.movePiece(0,1),this.game.score+=this.game.points.SOFT_DROP;else if(t.key===h.UP)this.game.rotatePiece();else if(t.key===h.SPACE){let s=this.game.piece;for(;this.game.board.isValid(this.game.board.drop(s));)this.game.piece.move(this.game.board.drop(s)),this.game.score+=this.game.points.HARD_DROP;this.game.piece.hardDropped=!0,this.game.lockPiece()}}})}}class O{constructor(e){this.ctx=e,this.board=new y(e),this.piece=null,this.nextPiece=null,this.renderer=new E(e),this.input=new v(this),this.points=c,this.score=0,this.lines=0,this.level=0,this.gameOver=!1,this.animationId=null,this.lastTime=0,this.dropCounter=0,this.dropInterval=d[0]}start(){this.reset(),this.piece=new x(this.ctx),this.piece.setStartingPosition(),this.animate()}reset(){this.board=new y(this.ctx),this.score=0,this.lines=0,this.level=0,this.gameOver=!1,this.dropInterval=d[0],this.updateScore()}animate(e=0){const t=e-this.lastTime;this.lastTime=e,this.dropCounter+=t,this.dropCounter>this.dropInterval&&(this.drop(),this.dropCounter=0),this.renderer.draw(this.board,this.piece),this.gameOver?this.drawGameOver():this.animationId=requestAnimationFrame(this.animate.bind(this))}drop(){let e=this.board.drop(this.piece);this.board.isValid(e)?this.piece.move(e):this.lockPiece()}lockPiece(){this.board.freeze(this.piece);const e=this.board.clearLines();e>0&&this.updateDetails(e),this.piece=new x(this.ctx),this.piece.setStartingPosition(),this.board.isValid(this.piece)||(this.gameOver=!0)}movePiece(e,t){let s=JSON.parse(JSON.stringify(this.piece));s.x+=e,s.y+=t,this.board.isValid(s)&&this.piece.move(s)}rotatePiece(){let e=this.board.rotate(this.piece);this.board.isValid(e)&&this.piece.move(e)}updateDetails(e){this.lines+=e,e===1?this.score+=c.SINGLE*(this.level+1):e===2?this.score+=c.DOUBLE*(this.level+1):e===3?this.score+=c.TRIPLE*(this.level+1):e===4&&(this.score+=c.TETRIS*(this.level+1)),this.level=Math.floor(this.lines/10),this.dropInterval=d[Math.min(this.level,d.length-1)],this.updateScore()}updateScore(){const e=document.getElementById("score"),t=document.getElementById("lines"),s=document.getElementById("level");e&&(e.innerText=this.score),t&&(t.innerText=this.lines),s&&(s.innerText=this.level)}drawGameOver(){this.ctx.fillStyle="rgba(0, 0, 0, 0.75)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.font="2px Arial",this.ctx.fillStyle="white",this.ctx.font="40px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.ctx.canvas.width/2,this.ctx.canvas.height/2)}}const w=document.getElementById("board"),m=w.getContext("2d");m.canvas.width=p*o;m.canvas.height=f*o;const P=new O(m);document.querySelector("#play-btn").addEventListener("click",()=>{document.querySelector(".start-screen").style.display="none",P.start()});
